@using Chirp.Core.Extensions
@using Chirp.WebService.Models
@model Chirp.WebService.Models.CheepPartialModel

<!--Parts of this code has been generated by Vercel V0: https://v0.dev/r/1b6ldi7gujp-->

@{
    var user = User.GetUser();
}

<div class="flex flex-col gap-4 p-4 rounded-lg shadow-lg bg-white border text-card-foreground cheeps">
    <div class="flex items-center gap-4">
        <a href="/@Model.AuthorUsername">
            <span class="relative flex shrink-0 overflow-hidden rounded-full w-12 h-12">
                <img
                    alt="User Avatar"
                    class="rounded-full aspect-square object-cover"
                    height="48"
                    src="@Model.AuthorAvatarUrl"
                    width="48"/>
            </span>
        </a>
        <div>
            <a href="/@Model.AuthorUsername" class="text-lg font-bold text-gray-900">@Model.AuthorName</a>
            <p class="text-sm text-gray-500">@Model.Timestamp</p>
        </div>
    </div>
    <p class="text-gray-800">
        @Model.Text
    </p>
    <div class="gap-4 flex flex-col space-y-3">
        <div class="flex gap-2">
            @if (Model.IsLikedByUser is not null)
                    {
                        @if (Model.IsLikedByUser ?? false)
                        {
                            <form asp-controller="Cheep" asp-action="Unlike" style="display:inline;">
                                <input type="hidden" name="cheepId" value="@Model.CheepId"/>
                                <input name="__RequestVerificationToken" type="hidden"/>
                                @Html.AntiForgeryToken()
                                <button type="submit" class="justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 flex items-center gap-2">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="h-5 w-5">
                                        <path d="M17 14V2"></path>
                                        <path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"></path>
                                    </svg>
                                    Unlike (@Model.LikesAmount)
                                </button>
                            </form>
                        }
                        else
                        {
                            <form asp-controller="Cheep" asp-action="Like" style="display:inline;">
                                <input type="hidden" name="cheepId" value="@Model.CheepId"/>
                                <input name="__RequestVerificationToken" type="hidden"/>
                                @Html.AntiForgeryToken()
                                <button type="submit" class="justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 flex items-center gap-2 bg-blue-200">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="h-5 w-5">
                                        <path d="M7 10v12"></path>
                                        <path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"></path>
                                    </svg>
                                    Like (@Model.LikesAmount)
                                </button>
                            </form>
                        }
                    }
            else
            {
                <div class="justify-center rounded-md text-sm font-medium transition-colors h-10 flex items-center gap-2">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="h-5 w-5">
                        <path d="M7 10v12"></path>
                        <path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"></path>
                    </svg>
                    @Model.LikesAmount Likes
                </div>
            }
            
            @if (Model.IsFollowedByUser is not null)
                    {
                        @if (Model.IsFollowedByUser ?? false)
                        {
                            <form asp-controller="Cheep" asp-action="Follow" style="display:inline;">
                                <input type="hidden" name="CheepAuthorId" value="@Model.AuthorId"/>
                                <input name="__RequestVerificationToken" type="hidden"/>
                                @Html.AntiForgeryToken()
                                <button type="submit" class="justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 flex items-center gap-2">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="h-5 w-5">
                                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    Follow
                                </button>
                            </form>
                        }
                        else
                        {
                            <form asp-controller="Cheep" asp-action="Unfollow" style="display:inline;">
                                <input type="hidden" name="CheepAuthorId" value="@Model.AuthorId"/>
                                <input name="__RequestVerificationToken" type="hidden"/>
                                @Html.AntiForgeryToken()
                                <button type="submit" class="justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 flex items-center gap-2">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="h-5 w-5">
                                        <path d="m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71"></path>
                                        <path d="m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71"></path>
                                        <line x1="8" x2="8" y1="2" y2="5"></line>
                                        <line x1="2" x2="5" y1="8" y2="8"></line>
                                        <line x1="16" x2="16" y1="19" y2="22"></line>
                                        <line x1="19" x2="22" y1="16" y2="16"></line>
                                    </svg>
                                    Unfollow
                                </button>
                            </form>
                        }
                    }
            
            @if (Model.AuthorId == user?.Id)
                {
                    <form asp-controller="Cheep" asp-action="Delete" style="display:inline;">
                        <input type="hidden" name="CheepAuthorId" value="@Model.AuthorId"/>
                        <input type="hidden" name="cheepId" value="@Model.CheepId"/>
                        <input name="__RequestVerificationToken" type="hidden"/>
                        @Html.AntiForgeryToken()
                        <button type="submit" id="cheepDeleteButton" class="rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-red-500 text-white hover:bg-accent hover:text-accent-foreground px-3 py-2 flex items-center gap-2">
                            Delete Cheep
                        </button>
                    </form>
                }
        </div>
        <!--Comment section -->
        <div>
            <form asp-controller="Comment" asp-action="Add" style="display:inline;" class="flex">
                <input type="hidden" name="AuthorId" value="@user?.Id"/>
                <input type="hidden" name="CheepId" value="@Model.CheepId"/>
                <input name="__RequestVerificationToken" type="hidden"/>
                <div class="flex items-center w-full gap-2">
                    <div class="my-4 flex-grow w-full">
                        <input class="border rounded-lg px-4 py-2" style="width:100%" type="text" placeholder="Write a comment..." name="CommentText"/>
                    </div>
                    @Html.AntiForgeryToken()
                    <button type="submit" class="rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 flex items-center gap-2">
                        Post comment
                    </button>
                </div>
            </form>
        </div>
    </div>    
    
    <div class="flex items-center gap-4 w-full">
        <div class="flex flex-grow">
            <div class="flex flex-col gap-2">
                @foreach (CommentPartialModel com in Model.CheepComments)
                {
                    //Build a model for the CommentPartial
                    <partial name="_CommentPartial" model="@com"/>
                }
            </div>    
        </div>
    </div>
</div>