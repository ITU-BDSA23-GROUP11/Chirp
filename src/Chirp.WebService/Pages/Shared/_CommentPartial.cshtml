@using Chirp.Core.Dto
@using Chirp.Core.Extensions
@using Chirp.WebService.Extensions
@model Chirp.WebService.Models.CommentPartialModel;

//Parts of this code has been generated by Vercel V0: https://v0.dev/r/1b6ldi7gujp

@{
    var user = User.GetUser();
}

<div class="flex flex-col gap-4 px-4 py-2 rounded-lg shadow-lg bg-white w-full">
    <div class="flex items-center gap-4">
        <a href="/@Model.AuthorUsername">
            <span class="relative flex shrink-0 overflow-hidden rounded-full w-6 h-6">
                <img
                    alt="Comment user avatar"
                    class="rounded-full aspect-square object-cover"
                    height="24"
                    src="@Model.AuthorAvatarUrl"
                    width="24"/>
            </span>
        </a>
        <div class="flex gap-2">
            <div>
                <a href="/@Model.AuthorUsername" class="text-sm font-bold text-gray-900">@Model.AuthorName</a>
                <p class="text-xs text-gray-500">@Model.Timestamp</p>
            </div>
        </div>
        <div>
            <!-- If the user owns the cheep or comment -> allowed to delete -->
            @if (user?.Id == @Model.AuthorId || user?.Id == @Model.CheepAuthorId)
            {
                <div>
                    <form asp-controller="Comment" asp-action="Delete" style="display:inline;" class="flex">
                        <input type="hidden" name="CommentId" value="@Model.CommentId"/>
                        <input name="__RequestVerificationToken" type="hidden"/>
                        <div class="flex items-center w-full gap-2">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-red-500 text-white hover:bg-accent hover:text-accent-foreground px-3 py-2 flex items-center gap-2">
                                Delete comment
                            </button>
                        </div>
                    </form>
                </div>
            }
        </div>
    </div>
    <div class="flex">
        <p>@Model.Text</p>
    </div>
</div>